<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Song List</title>
    <link rel="stylesheet" href="songs.css">
    <script src="jquery-1.11.1.js"></script>
</head>
<body>
    <h1 align="center">歌曲列表</h1>
    <hr>
    <button id="viewSongsBtn" class="viewSongsBtn">查看歌曲</button>
    <hr>
    <div id="view-songs-section">
        <h2>查看歌曲</h2>
        <select id="genre-filter" class="outer_div" title="选择歌曲类型">
            <option value="title">选择歌曲类型</option>
            <option value="流行">流行</option>
            <option value="民谣">民谣</option>
            <option value="民谣">民谣</option>
            <option value="爵士">爵士</option>
            <option value="古典">古典</option>
            <option value="电子">电子</option>
            <option value="说唱">说唱</option>
            <option value="乡村">乡村</option>
        </select>
        

        <button id="view-all-songs" class="addSongBtn">查看全部歌曲</button>

        <table id="song-list" border="1">
            <thead>
                <tr>
                    <th>歌名</th>
                    <th>歌手</th>
                    <th>歌曲类型</th>
                    <th>播放量</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <script>

        $(document).ready(function() {
            // Hide sections initially
            $('#view-songs-section').hide();
            
            // Show view songs section
            $('#viewSongsBtn').on('click', function() {
                $('#add-song-section').hide();
                $('#view-songs-section').show();
                fetchSongs();
            });

            // Function to fetch and display songs
            function fetchSongs(filterGenre = "") {
                $.ajax({
                    url: '/songs',
                    method: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        const songs = data.SongCollection.Song;
                        let html = '';
                        songs.forEach(song => {
                            if (!filterGenre || song.Genre[0] === filterGenre) {
                                html += `<tr>
                                    <td>${song.Id[0]}</td>
                                    <td>${song.Title[0]}</td>
                                    <td>${song.Artist[0]}</td>
                                    <td>${song.Genre[0]}</td>
                                    <td>${song.PlayCount[0]}</td>
                                </tr>`;
                            }
                        });
                        $('#song-list tbody').html(html);
                    },
                    error: function(error) {
                        console.error('Error fetching songs', error);
                    }
                });
            }

           
            // Handle genre filter change
            $('#genre-filter').on('change', function() {
                const selectedGenre = $(this).val();
                fetchSongs(selectedGenre);
            });

            // Handle view all songs button
            $('#view-all-songs').on('click', function() {
                fetchSongs();
            });

            // Handle reset songs button
            $('#reset-songs').on('click', function() {
                $.ajax({
                    url: '/reset-songs',
                    method: 'POST',
                    success: function() {
                        fetchSongs();
                    },
                    error: function(error) {
                        console.error('Error resetting songs', error);
                    }
                });
            });
        });
    </script>
</body>
</html>
